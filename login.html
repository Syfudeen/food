<!DOCTYPE html>
<html>
<head>
	<title>Login Page</title>
	<link rel="stylesheet" href="style.css">
	<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
	<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
	<style>
		.overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.8);
			display: none;
			justify-content: center;
			align-items: center;
			z-index: 1000;
		}
		.forgot-password-modal {
			background: white;
			border-radius: 15px;
			padding: 30px;
			max-width: 400px;
			width: 90%;
			box-shadow: 0 15px 35px rgba(0,0,0,0.2);
		}
		.modal-header {
			text-align: center;
			margin-bottom: 20px;
		}
		.modal-header h3 {
			color: #ff4500;
			margin: 0;
		}
		.form-group {
			margin-bottom: 15px;
		}
		.form-group label {
			display: block;
			margin-bottom: 5px;
			font-weight: 600;
		}
		.form-group input {
			width: 100%;
			padding: 10px;
			border: 2px solid #e9ecef;
			border-radius: 8px;
			box-sizing: border-box;
		}
		.btn-reset {
			background: #ff4500;
			color: white;
			border: none;
			padding: 12px 20px;
			border-radius: 8px;
			cursor: pointer;
			width: 100%;
			font-weight: 600;
		}
		.btn-reset:hover {
			background: #ff6b35;
		}
		.btn-reset:disabled {
			opacity: 0.6;
			cursor: not-allowed;
		}
		.close-modal {
			float: right;
			font-size: 24px;
			cursor: pointer;
			color: #666;
		}
		.alert {
			padding: 10px;
			border-radius: 8px;
			margin-bottom: 15px;
		}
		.alert-success {
			background: #d4edda;
			color: #155724;
			border: 1px solid #c3e6cb;
		}
		.alert-error {
			background: #f8d7da;
			color: #721c24;
			border: 1px solid #f5c6cb;
		}
		.loading {
			text-align: center;
			padding: 10px;
		}
	</style>
</head>
<body>
<div class="form">
	<h3 class="form-title">LOGIN</h3>
	<div id="message-container"></div>

	<form class="form-body" onsubmit="handleLogin(event)">
		<label>Email:</label>
		<input type="email" name="email" id="email" required>

		<label>Password:</label>
		<input type="password" name="password" id="password" required>

		<button type="submit">Login</button>
	</form>

	<div class="forgot-password">
		<a href="#" onclick="showForgotPassword()">Forgot Password?</a>
	</div>
</div>

<!-- Forgot Password Overlay -->
<div id="forgotPasswordOverlay" class="overlay">
	<div class="forgot-password-modal">
		<span class="close-modal" onclick="closeForgotPassword()">&times;</span>
		<div class="modal-header">
			<h3>ðŸ”‘ Forgot Password</h3>
			<p>Enter your email to reset your password</p>
		</div>
		
		<div id="forgotAlertContainer"></div>
		
		<form id="forgotPasswordForm" onsubmit="handleForgotPassword(event)">
			<div class="form-group">
				<label for="forgotEmail">Email Address:</label>
				<input type="email" id="forgotEmail" required placeholder="Enter your registered email">
			</div>
			
			<button type="submit" class="btn-reset" id="resetBtn">
				Send Reset Link
			</button>
		</form>
		
		<div id="loadingDiv" class="loading" style="display: none;">
			<div>ðŸ“§ Sending reset link...</div>
		</div>
	</div>
</div>

<script>
	const firebaseConfig = {
		apiKey: "AIzaSyD5KKgtq-2Qd__pn_w6zWUPJpUwtaTw4Fg",
		authDomain: "restaurant-app-fed29.firebaseapp.com",
		projectId: "restaurant-app-fed29",
		storageBucket: "restaurant-app-fed29.firebasestorage.app",
		messagingSenderId: "613195852332",
		appId: "1:613195852332:web:651998b37c46c52fa07f89",
		measurementId: "G-28C4BH7GC4"
	};

	// Initialize Firebase
	try {
		firebase.initializeApp(firebaseConfig);
		console.log('Firebase initialized successfully');
	} catch (error) {
		console.log('Firebase already initialized or error:', error);
	}

	const auth = firebase.auth();

	console.log('Login page loaded');

	function handleLogin(event) {
		event.preventDefault();
		
		const email = document.getElementById('email').value;
		const password = document.getElementById('password').value;
		
		console.log('Login attempt with:', email);

		// Simple test - just store in localStorage for now
		try {
			localStorage.setItem('userEmail', email);
			localStorage.setItem('isLoggedIn', 'true');
			
			// Show success message
			showMessage('Login successful! Redirecting...', 'success');
			
			// Redirect to home page after 2 seconds
			setTimeout(() => {
				window.location.href = 'index.html';
			}, 2000);
			
		} catch (error) {
			console.error('Login error:', error);
			showMessage('Login failed. Please try again.', 'error');
		}
	}

	function showForgotPassword() {
		document.getElementById('forgotPasswordOverlay').style.display = 'flex';
		document.getElementById('forgotAlertContainer').innerHTML = '';
		document.getElementById('forgotEmail').value = '';
	}

	function closeForgotPassword() {
		document.getElementById('forgotPasswordOverlay').style.display = 'none';
	}

	async function handleForgotPassword(event) {
		event.preventDefault();
		
		const email = document.getElementById('forgotEmail').value.trim();
		
		if (!email) {
			showForgotAlert('Please enter your email address', 'error');
			return;
		}

		// Show loading state
		document.getElementById('resetBtn').disabled = true;
		document.getElementById('resetBtn').innerHTML = 'ðŸ“§ Sending...';
		document.getElementById('loadingDiv').style.display = 'block';
		document.getElementById('forgotPasswordForm').style.display = 'none';

		try {
			await auth.sendPasswordResetEmail(email);

			document.getElementById('resetBtn').disabled = false;
			document.getElementById('resetBtn').innerHTML = 'Send Reset Link';
			document.getElementById('loadingDiv').style.display = 'none';
			document.getElementById('forgotPasswordForm').style.display = 'block';

			showForgotAlert('âœ… Password reset link has been sent to your email! Please check your inbox.', 'success');
			document.getElementById('forgotEmail').value = '';

			setTimeout(() => {
				closeForgotPassword();
				showMessage('Reset link sent! Please check your email.', 'success');
			}, 3000);
		} catch (error) {
			document.getElementById('resetBtn').disabled = false;
			document.getElementById('resetBtn').innerHTML = 'Send Reset Link';
			document.getElementById('loadingDiv').style.display = 'none';
			document.getElementById('forgotPasswordForm').style.display = 'block';

			console.error('Firebase reset password error:', error);
			const code = error && error.code ? error.code : '';
			let msg = 'Failed to send reset link. Please try again.';
			if (code === 'auth/user-not-found') msg = 'No account found with this email address.';
			else if (code === 'auth/invalid-email') msg = 'Invalid email address.';
			else if (code === 'auth/too-many-requests') msg = 'Too many requests. Try again later.';
			else if (code === 'auth/unauthorized-domain') msg = 'This domain is not authorized in Firebase. Add it in Firebase Auth -> Settings -> Authorized domains.';
			showForgotAlert(msg, 'error');
		}
	}

	function showMessage(message, type) {
		const messageContainer = document.getElementById('message-container');
		const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
		messageContainer.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
		
		// Clear message after 5 seconds
		setTimeout(() => {
			messageContainer.innerHTML = '';
		}, 5000);
	}

	function showForgotAlert(message, type) {
		const alertContainer = document.getElementById('forgotAlertContainer');
		const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
		alertContainer.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
	}

	// Close overlay when clicking outside
	window.onclick = function(event) {
		const overlay = document.getElementById('forgotPasswordOverlay');
		if (event.target === overlay) {
			closeForgotPassword();
		}
	}
</script>
</body>
</html>

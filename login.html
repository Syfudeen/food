<!DOCTYPE html>
<html>
<head>
	<title>Login Page</title>
	<link rel="stylesheet" href="style.css">
	<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
	<style>
		body{
			padding-top:100px;
		}
		.forgot-password{
			text-align:center;
			margin-top:15px;
		}
		.forgot-password a{
			color:#ff4500;
			text-decoration:none;
			font-size:14px;
		}
		.forgot-password a:hover{
			text-decoration:underline;
		}
		.message{
			text-align:center;
			padding:10px;
			margin:10px 0;
			border-radius:5px;
		}
		.success{
			background-color:#d4edda;
			color:#155724;
			border:1px solid #c3e6cb;
		}
		.error{
			background-color:#f8d7da;
			color:#721c24;
			border:1px solid #f5c6cb;
		}
	</style>
</head>
<body>

<div class="form">
	<h3 class="form-title">LOGIN</h3>
	<div id="message-container"></div>

	<form class="form-body" action="/login" method="post">
		<label>Email:</label>
		<input type="email" name="email" id="email" required>

		<label>Password:</label>
		<input type="password" name="password" id="password" required>

		<button type="submit">Login</button>
	</form>

	<div class="forgot-password">
		<a href="#" onclick="showForgotPassword(event)">Forgot Password?</a>
	</div>

	<div id="forgot-form" style="display:none;margin-top:20px;">
		<h4>Reset Password</h4>
		<form onsubmit="handleForgotPassword(event)">
			<label>Email:</label>
			<input type="email" id="forgot-email" required>
			<button type="submit">Send Reset Link</button>
		</form>
	</div>
</div>

<script>
function showForgotPassword(e){
	e.preventDefault();
	document.getElementById("forgot-form").style.display="block";
}

function showMessage(message,type){
	const container=document.getElementById("message-container");
	container.innerHTML=`<div class="message ${type}">${message}</div>`;
	setTimeout(()=>{container.innerHTML=""},5000);
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyD5KKgtq-2Qd__pn_w6zWUPJpUwtaTw4Fg",
    authDomain: "restaurant-app-fed29.firebaseapp.com",
    projectId: "restaurant-app-fed29",
    storageBucket: "restaurant-app-fed29.firebasestorage.app",
    messagingSenderId: "613195852332",
    appId: "1:613195852332:web:aa3a76d763d87cc2a07f89"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

window.handleForgotPassword = function(e) {
    e.preventDefault();
    const email = document.getElementById("forgot-email").value;
    
    // First check if user exists in our database
    fetch('/forgot-password', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email: email })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // User exists, now send Firebase reset email
            sendPasswordResetEmail(auth, email)
                .then(() => {
                    showMessage('Password reset link sent to your email!', 'success');
                    document.getElementById('forgot-form').style.display = 'none';
                })
                .catch((error) => {
                    console.error('Firebase error:', error);
                    showMessage('Failed to send reset link: ' + error.message, 'error');
                });
        } else {
            showMessage(data.message || 'Email not found', 'error');
        }
    })
    .catch((error) => {
        console.error('Error:', error);
        showMessage('Failed to process request', 'error');
    });
};
</script>

</body>
</html>

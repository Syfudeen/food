<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <style>
        body { padding-top: 50px; font-family: 'Poppins', sans-serif; }
        .form { width: 300px; margin: auto; }
        .form-title { text-align: center; margin-bottom: 20px; }
        input, textarea, button { width: 100%; margin-bottom: 10px; padding: 8px; }
        button { background-color: #ff4500; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #e03e00; }
    </style>
</head>
<body>
    <div class="form">
        <h3 class="form-title">Sign Up</h3>
        <form class="form-body" onsubmit="signupUser(event)">
            <label>Name:</label>
            <input type="text" name="name" required>

            <label>Email:</label>
            <input type="email" name="email" required>

            <label>Phone Number:</label>
            <input type="number" name="phone" required>

            <label>Password:</label>
            <input type="password" name="password" required>

            <label>Address:</label>
            <textarea name="address" placeholder="Your address..."></textarea>

            <button type="submit">Submit</button>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD5KKgtq-2Qd__pn_w6zWUPJpUwtaTw4Fg",
            authDomain: "restaurant-app-fed29.firebaseapp.com",
            projectId: "restaurant-app-fed29",
            storageBucket: "restaurant-app-fed29.firebasestorage.app",
            messagingSenderId: "613195852332",
            appId: "1:613195852332:web:aa3a76d763d87cc2a07f89"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        window.signupUser = function(event) {
            event.preventDefault();

            const name = document.querySelector('input[name="name"]').value;
            const email = document.querySelector('input[name="email"]').value;
            const phone = document.querySelector('input[name="phone"]').value;
            const password = document.querySelector('input[name="password"]').value;
            const address = document.querySelector('textarea[name="address"]').value;

            // 1️⃣ Create user in Firebase Auth
            createUserWithEmailAndPassword(auth, email, password)
            .then(userCredential => {
                const user = userCredential.user;
                console.log("Firebase user created:", user.uid);

                // 2️⃣ Send user info to backend MySQL
                fetch('/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, phone, password, address })
                })
                .then(res => res.text())
                .then(data => {
                    alert(`Welcome ${name}! Signup successful. Please login.`);
                    window.location.href = "login.html";
                })
                .catch(err => console.error("Backend signup error:", err));
            })
            .catch(error => {
                console.error("Firebase signup error:", error.message);
                alert(error.message);
            });
        };
    </script>
</body>
</html>
